# FWF Readme

There are 4 main components to the FWF processing:

(1) Project RACMO runoff onto polar stereo grid
(2) Route projected runoff to land pixels immediately adjacent to oceans
(3) Compute solid ice discharge time series 
(4) Create ocean basins raster from IHO definitions

Set the environment variable `PROCESS_DIR` to the location where you are undertaking all processing for this project. 


## Projecting runoff to polar stereo grid

This process is very quick - just a few minutes on desktop machine for entire time series.

Script: `reproject_racmo.py`


## Routing

Uses the PyGeoProcessing toolbox. The toolbox only runs under Python 2.7 (at least as far as I can tell), so requires a new conda environment that looks something like this:

    conda create -n pygeoprocess
    source activate pygeoprocess
    conda install -c conda-forge python=2.7 numpy scipy cython gdal shapely
    pip install pygeoprocessing


## Solid ice discharge



## Ocean basins mask

Script: `allocate_coast_to_basin.py`. See script for citation of IHO data source



## Masks - November/December 2017 update

There are four sources of masks:

RACMO run @ ~11 km point grid resolution
   - LSMGr
   - icemask
   - LandSeaMask
   - Promicemask
   - GrIS_caps_mask
   - Geopotential (topography)
   - ----> all these wind up as mask_<name>.tif.
RACMO @ 1km NCAA
    - Ice mask
    - topography
RACMO @ 1 km SCAA
    - ice mask
    - topography
RACMO @ 1 km GRIS
    - ice mask
    - topography

After racmohires2gtiff.py is run, another two key masks are generated as geotiffs:
- mask_Geopotential_mosaic.tif
- mask_icemask_mosaic.tif
These contain the higher-res (1km-derived) topo and ice masks respectively.

From this point on it is therefore important not to use 11 km base masks in application to any 1km downsampled areas! (the bounds will be wrong).

The regional masks rema


## Main differences in Nov/Dec 2017 update

* Improved the masking used for the tundra, which led to a dramatic reduction (50%) in tundra runoff compared to runoff v1. New values more in line with Bamber 2012 paper, a little lower in fact.
